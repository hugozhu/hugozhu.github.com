<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Hugo Zhu's Blog</title>
<meta name=description content="VidHub - My favorite Video Player on iPad/iPhone "><meta name=author content="Hugo Zhu"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"All about Raspberry Pi","url":"https:\/\/blog.hugozhu.site\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/blog.hugozhu.site\/"}</script><meta property="og:title" content="All about Raspberry Pi"><meta property="og:description" content="VidHub - My favorite Video Player on iPad/iPhone "><meta property="og:image" content="https://blog.hugozhu.site/img/pi.png"><meta property="og:url" content="https://blog.hugozhu.site/"><meta property="og:type" content="website"><meta property="og:site_name" content="All about Raspberry Pi"><meta name=twitter:title content="All about Raspberry Pi"><meta name=twitter:description content="VidHub - My favorite Video Player on iPad/iPhone "><meta name=twitter:image content="https://blog.hugozhu.site/img/pi.png"><meta name=twitter:card content="summary_large_image"><link href=https://blog.hugozhu.site/img/pi.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.128.2"><link rel=alternate href=https://blog.hugozhu.site/index.xml type=application/rss+xml title="All about Raspberry Pi"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://blog.hugozhu.site/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://blog.hugozhu.site/css/highlight.min.css><link rel=stylesheet href=https://blog.hugozhu.site/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-W88HDMN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-W88HDMN")}</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://blog.hugozhu.site/>All about Raspberry Pi</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Tools</a><div class=navlinks-children><a href=https://nddapp.com/json-encoder.html>HTML Tools</a>
<a href=https://www.birme.net/>Imaeg Resizing</a>
<a href=https://jwt.io/>JWT Token Tool</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li><a href=#modalSearch data-toggle=modal data-target=#modalSearch style=outline:none><span class="hidden-sm hidden-md hidden-lg">Search</span> <span id=searchGlyph class="glyphicon glyphicon-search"></span></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="All about Raspberry Pi" href=https://blog.hugozhu.site/><img class=avatar-img src=https://blog.hugozhu.site/img/pi.png alt="All about Raspberry Pi"></a></div></div></div></nav><div id=modalSearch class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal>&#215;</button><h4 class=modal-title>Search All about Raspberry Pi</h4></div><div class=modal-body><gcse:search></gcse:search></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>Close</button></div></div></div></div><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=page-heading><h1>Hugo Zhu's Blog</h1><hr class=small></div></div></div></div></div></header><div role=main class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=well><div align=center><b><a href="https://apps.apple.com/app/apple-store/id1659622164?pt=118612019&ct=hugo&mt=8">VidHub - My favorite Video Player on iPad/iPhone</a></b></div><a href="https://apps.apple.com/app/apple-store/id1659622164?pt=118612019&ct=hugo&mt=8"><img width=200 src=https://is1-ssl.mzstatic.com/image/thumb/Purple211/v4/51/c6/ff/51c6ff77-e5b0-c53d-2f1a-b659fbc20581/AppIcon-0-0-85-220-0-0-4-0-2x.png/492x0w.webp></a>
<a href="https://apps.apple.com/app/apple-store/id1659622164?pt=118612019&ct=hugo&mt=8"><img width=200 src=https://static-00.iconduck.com/assets.00/app-ios-icon-2048x607-djvn0n0l.png></a></div><div class=posts-list><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/42-sharp-gp2y1010au0f-optical-dust-sensor/><h2 class=post-title>使用夏普GP2Y1010AU0F灰尘传感器检测空气质量</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 21, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;273&nbsp;words</span></p><div class=post-entry>夏普GP2Y1010AU0F灰尘传感器价格较便宜，能检测出室内空气中的灰尘和烟尘含量。另外还有韩国SYHITECH生产的DSM501A粉尘传感器也有类似功能。
检测原理 其原理如下图，传感器中心有个洞可以让空气自由流过，定向发射LED光，通过检测经过空气中灰尘折射过后的光线来判断灰尘的含量。
电路图 因为数据是通过pin 5的电压模拟信号输出的，而树莓派的引脚不支持模拟信号直接读取（需要增加数模转换芯片），所以先用Arduino来实验。
Arduino 代码 根据电路图， 把Arduino和传感器连接起来：
Sharp pin 1 (V-LED) => 5V 串联1个150欧姆的电阻（最好在电阻一侧和GND之间再串联一个220uf的电容） Sharp pin 2 (LED-GND) => GND Sharp pin 3 (LED) => Arduino PIN 2 （开关LED） Sharp pin 4 (S-GND) => GND Sharp pin 5 (Vo) => Arduino A0 pin （空气质量数据通过电压模拟信号输出） Sharp pin 6 (Vcc) => 5V /* Interface to Sharp GP2Y1010AU0F Particle Sensor Program by Christopher Nafis Written April 2012 http://www.sparkfun.com/datasheets/Sensors/gp2y1010au_e.pdf http://sensorapp.net/?p=479 Sharp pin 1 (V-LED) => 5V (connected to 150ohm resister) Sharp pin 2 (LED-GND) => Arduino GND pin Sharp pin 3 (LED) => Arduino pin 2 Sharp pin 4 (S-GND) => Arduino GND pin Sharp pin 5 (Vo) => Arduino A0 pin Sharp pin 6 (Vcc) => 5V */ #include &lt;SPI.
<a href=https://blog.hugozhu.site/post/2013/42-sharp-gp2y1010au0f-optical-dust-sensor/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/arduino/>Arduino</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/41-use-phantomjs-on-raspberry-pi-to-login-weibo/><h2 class=post-title>在树莓派上使用Phantomjs自动登录微博</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 21, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;196&nbsp;words</span></p><div class=post-entry>使用过新浪开放平台的朋友都知道用户对小应用（用户数较少的）的授权Token很容易过期，自动续期要求授权过的用户在过期前重新打开授权页。如果你想实现一个自动备份自己微博的App，就不得每天（周）自己去访问授权页（想死的心都有了吧？）。这里介绍一种通过脚本自动登录微博获取最新oAuth token的方法（需要微博登录名和密码），合适自己玩。将脚本部署在树莓派上后，我再也不用每周都去登录一次授权页了，只是收到报警消息后（经常是帐号被冻结了）需要手动处理一下。
Phantomjs Phantomjs 是一个开源的，没有界面可运行在命令行，跨平台，基于WebKit的全功能浏览器，可以用来做网站自动化测试。从源代码编译比较费时间，可以直接下载二进制版本，树莓派的版本在这里可下载。Phantomjs下载好了后就一个可执行文件，依赖非常少，我很喜欢这种方式。
代码 以下代码使用提供的微博用户名和密码登录，获得Token后还会打开微博首页看帐号是否被冻结了。
var page = require('webpage').create(), system = require('system'), fs = require('fs'), address; var weibo_userid = system.args[1] var weibo_passwd = system.args[2] var startUrl = "https://api.weibo.com/oauth2/authorize?client_id=&lt;your_app_key>&amp;redirect_uri=&lt;your_return_url>/&amp;response_type=token"; var verify_weibo_freeze = false; page.onResourceReceived = function (res,network) { if (res.stage == "end") { // console.log("\t&lt;-" + res.url); if (res.url.indexOf("authorize?client_id")>0) { startUrl = res.url } if (res.url.indexOf("?access_token")>0) { var pos1 = res.url.indexOf("access_token=") var pos2 = res.url.indexOf("&") var access_token = res.url.substring(pos1+"access_token=".length, pos2) console.
<a href=https://blog.hugozhu.site/post/2013/41-use-phantomjs-on-raspberry-pi-to-login-weibo/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/javascript/>Javascript</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/40-try-out-sublime-3-beta-on-mac/><h2 class=post-title>在Mac上使用Sublime 3写Go代码</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 11, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;91&nbsp;words</span></p><div class=post-entry>Sublime 是一个相当好用的文本编辑器，界面简洁，功能强大。最近Sublime 3 Beta 出来了, 体验了一下，发现启动速度比之前快了很多。
下载安装 下载地址： http://www.sublimetext.com/3
安装Package Control Sublime 支持插件来丰富其功能，package control 本身也是一个插件，可以用来管理其他插件，所以我们要先安装Package Control，Sublime 3需要安装Pacakge Control Alpha.
cd "Library/Application Support/Sublime Text 3" cd Packages/ git clone https://github.com/wbond/sublime_package_control.git "Package Control" cd "Package Control" git checkout python3 安装GoSublime 重启Sublime后
按cmd+shift+p (OS X)或press ctrl+shift+p (Windows, Linux) 在弹出的输入框中输入 PacInstall 选择 Package Control: Install Package 在稍后弹出的输入框内输入"Gosublime"，选择安装 好了，就这样可以开始写Go代码了。
Tips 我的Sublime配置
{ "font_face": "Microsoft YaHei", "font_options": [ ], "font_size": 18.0, "line_padding_top": 0 } 按快捷键Shift + Command + L可以按列编辑
<a href=https://blog.hugozhu.site/post/2013/40-try-out-sublime-3-beta-on-mac/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/sublime/>Sublime</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/39-replace-usb-disk-on-raspberry-pi/><h2 class=post-title>替换树莓派的U盘</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 11, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;66&nbsp;words</span></p><div class=post-entry><p>除了SD卡上的存储，树莓派还可以使用U盘来做存储，有时候我们可能需要替换已有的U盘为更大容量的。在Mac上可以采用下面的方法：</p><ol><li><p>备份已有的U盘，把U盘从树莓派上拔下来插在Mac上，找出U盘对应的盘符（下例为<code>/dev/disk2</code>）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>20:51:19 hugozhu-mac-mini ~ $ diskutil list
</span></span><span class=line><span class=cl>/dev/disk0
</span></span><span class=line><span class=cl>   #:                       TYPE NAME                    SIZE       IDENTIFIER
</span></span><span class=line><span class=cl>   0:      GUID_partition_scheme                        *500.1 GB   disk0
</span></span><span class=line><span class=cl>   1:                        EFI                         209.7 MB   disk0s1
</span></span><span class=line><span class=cl>   2:                  Apple_HFS Macintosh HD            499.2 GB   disk0s2
</span></span><span class=line><span class=cl>   3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3
</span></span><span class=line><span class=cl>/dev/disk2
</span></span><span class=line><span class=cl>   #:                       TYPE NAME                    SIZE       IDENTIFIER
</span></span><span class=line><span class=cl>   0:     FDisk_partition_scheme                        *2.1 GB     disk2
</span></span></code></pre></div><p>使用 dd 命令把U盘拷贝到<code>raspberrypi.img</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo dd if=/dev/disk2 of=raspberrypi.img conv=notrunc
</span></span></code></pre></div></li><li><p>从Mac上取下旧U盘，把新的U盘插入同一个USB口，注意新U盘容量要大于旧的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo dd of=/dev/disk2 if=raspberrypi.img conv=notrunc
</span></span></code></pre></div></li><li><p>把新U盘插入树莓派，并mount上，用以下命令把U盘的多余空间用起来</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>resize2fs /dev/sda
</span></span></code></pre></div></li></ol></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/linux/>Linux</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/38-java-volatile-variable/><h2 class=post-title>Java并发中正确使用volatile</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on June 30, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;197&nbsp;words</span></p><div class=post-entry>前几天并发编程群里有同学对volatile的用法提出了疑问，刚好我记得Twitter有关实时搜索的这个PPT对这个问题解释的很清晰并有一个实际的应用场景，于是周末把这个问题摘录了一些和并发相关的内容如下：
并发 - 定义 悲观锁 - Pressimistic locking 一个线性在执行一个操作时持有对一个资源的独占锁。（互斥） 一般用在冲突比较可能发生的场景下 乐观锁 - Optimistic locking 尝试采用原子操作，而不需要持有锁；冲突可被检测，如果发生冲突，具有相应的重试逻辑 通常用在冲突较少发生的场景下 非阻塞算法 - Non-blocking algorithm 算法确保对线程间竞争共享资源时候，不会因为互斥而使任一线程的执行无限延迟； 无锁算法 - Lock-free algorithm 如果系统整个流程的执行是无阻塞的(系统某一部分可能被短暂阻塞)，这种非阻塞算法就是无锁的。 无锁算法比传统的基于锁的算法对系统的开销更小，且更容易在多核多CPU处理器上扩展； 在实时系统中可以避免锁带来的延迟； CAS (compare and swap)或LL/SC(load linked/store conditional)，以及内存屏障相关的指令经常被用在算法实现中。 无等待算法 - Wait-free algorithm 如果每个线程的执行都是无阻塞的，这种非阻塞算法就是无等待的（比无锁算法更好） Java的并发 Java的内存模型并不保证一个线程可以一直以程序执行的顺序看到另一个线程对变量的修改，除非两个线程都跨越了同一个内存屏障。（Safe publication） Java内存模型 代码顺序规则 一个线程内的每个动作 happens-before 同一个线程内在代码顺序上在其后的所有动作 volatile变量规则 对一个volatile变量的读，总是能看到（任意线程）对这个volatile变量最后的写入 传递性 如果A happens-before B, B happens-before C，那 A happens-before C Safe publication案例 class VolatileExample { int x = 0; volatile int b = 0; private void write() { x = 5; b = 1; } private void read() { int dummy = b; while (x!
<a href=https://blog.hugozhu.site/post/2013/38-java-volatile-variable/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/concurrency/>Concurrency</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/37-tcpdump_on_android/><h2 class=post-title>在Android上使用tcpdump</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on June 24, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;100&nbsp;words</span></p><div class=post-entry>tcpdump工具是分析网络协议和数据包的利器，也可以在Android上使用（需要root）。
首先在android上安装tcpdump
wget http://www.strazzere.com/android/tcpdump adb push tcpdump /data/local/tmp/tcpdump adb chmod 755 /data/local/tmp/tcpdump 然后使用root用户启动tcpdump，在android上进行相应的操作后，按ctrl+c中断
adb shell shell@android:/ $ su root@android:/ # /data/local/tmp/tcpdump -h tcpdump version 3.9.8 libpcap version 0.9.8 Usage: tcpdump [-aAdDeflLnNOpqRStuUvxX] [-c count] [ -C file_size ] [ -E algo:secret ] [ -F file ] [ -i interface ] [ -M secret ] [ -r file ] [ -s snaplen ] [ -T type ] [ -w file ] [ -W filecount ] [ -y datalinktype ] [ -Z user ] [ expression ] root@android:/ # /data/local/tmp/tcpdump -p -vv -s 0 w /sdcard/capture.
<a href=https://blog.hugozhu.site/post/2013/37-tcpdump_on_android/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/android/>Android</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/36-use-ping-to-check-network-connectivity/><h2 class=post-title>使用Ping来检查网络连通性</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on June 1, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;100&nbsp;words</span></p><div class=post-entry>树莓派使用了一个无线网卡连接家里的无线路由器，在实际使用过程中发现连续运行多天后会掉线，而且掉线后基本上就再也连不上网了，需要重启树莓派才能恢复，十分麻烦。
假设无线路由器IP是192.168.1.1，于是每隔15分钟检查一下，是否能从树莓派上ping通路由器；如果不能则重启无线网络，脚本如下：
network.sh
#!/bin/bash export PATH=/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin ping_count() { count=0 `timeout 5 ping 192.168.1.1 | while read LINE; do { if [[ "${LINE}" =~ "64 bytes from" ]]; then let "count = $count + 1" echo "export count=$count" fi } done` echo $count } if [[ $(ping_count) &lt; 1 ]]; then ifconfig wlan0 ifconfig wlan0 down sleep 1 ifconfig wlan0 up sleep 1 netcfg -r wlan0-Hugo-Nas sleep 5 if [[ $(ping_count) &lt; 1 ]]; then echo "Fatal error: wifi is down, rebooting now.
<a href=https://blog.hugozhu.site/post/2013/36-use-ping-to-check-network-connectivity/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/shell-scripting/>Shell Scripting</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/35-understanding-output/><h2 class=post-title>树莓派的GPIO接口输出电流限制</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on May 14, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;21&nbsp;words</span></p><div class=post-entry><p>树莓派提供了一个连接头让我们访问CPU的17个GPIO接口，如下图</p><img src=https://www.evernote.com/shard/s26/sh/92d52938-5bd9-46a7-9b05-478e9f30f5d7/b29dcc510983784a07472c8282330b30/deep/0/Screenshot%205/14/13%208:51%20PM.png><p>这些接口可配置成输入或输出。本文主要讨论GPIO引脚作为输出时电流的限制。</p><h1 id=阻抗-impendance>阻抗 (impendance)</h1><p>阻抗和和电阻的区别（resistance）在于电阻的阻值是固定的，不会随着电流变化，阻抗则不然，可能随着外部变化，如电流或频率变化。从另一个角度来说，电阻是线性的，但阻抗不是。比如放大器的阻抗会随着输出的信号频率变化。</p><p>树莓派的的每个GPIO引脚都有一个寄存器可以设置引脚的驱动强度，也就是在保持输出电压为逻辑0和1的情况下，可以改变阻抗的大小从而改变GPIO引脚的输出电流大小。</p><p>通过如下电路测量相同电流下不同阻抗对应的GPIO电压输出（其中用到了一个电位器调节电流保持恒定）：</p><img src=https://www.evernote.com/shard/s26/sh/11008332-acac-4625-9b6a-963c97ec7498/1e6d153774b7e95214fe0c2bba9121d8/deep/0/Screenshot%205/14/13%2010:22%20PM.png><p>通过计算后，下表是当输出电流为2，4 … 16mA时，对应的阻抗大小以及如果发生短路时的短路电流大小。</p><img src=https://www.evernote.com/shard/s26/sh/7a411df0-56b1-4f76-bce5-54961bcfcfc7/4e46d9e28d7d01a34eb9e66ee28a5ba8/deep/0/Screenshot%205/14/13%2010:39%20PM.png><p>可以看出短路电流都是超过16mA的。</p><p>一个发光二极管压降约为1.5<del>2.0v，工作电流为3</del>10v</p><p>GPIO引脚的电流是通过板上的3.3V电压调整器输出的，树莓派是按平均每个引脚3mA来设计的，所以总的电流不能超过17 * 3 = 51mA。</p><h1 id=结论>结论</h1><p>树莓派引脚电流大小的限制是：<strong>每个引脚最大输出电流为16毫安(mA)，且同一时刻所有引脚的总输出电流不超过51毫安</strong></p><h1 id=参考链接>参考链接</h1><ol><li><a href=http://www.thebox.myzen.co.uk/Raspberry/Understanding_Outputs.html>http://www.thebox.myzen.co.uk/Raspberry/Understanding_Outputs.html</a></li></ol></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/raspberry-pi/>Raspberry Pi</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/34-use-74hc595-8-bit-shift-register-with-raspberry-pi/><h2 class=post-title>使用8位移位寄存器74HC595扩展树莓派的IO端口</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on May 13, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;305&nbsp;words</span></p><div class=post-entry>树莓派的GPIO接口数目有限，驱动一个步进电机需要占用4个， 一个Nokia 5110液晶也要占4个， 传感器输入至少需要一个，多玩几个外设后接口就不够用了。如果接口可以复用就可以让树莓派驱动更多的外设了，本文讨论如何使用74HC595集成电路芯片来扩展树莓派的I/O接口。
芯片介绍 SN74HC595N是德州仪器公司生产的集成电路芯片，是一个8位串行输入变串行输出或并行输出移位寄存器，具有高阻关断，高电平和低电平三态输出。在IO扩充上，可以最多串联15片，也就是高达120个IO扩充。
（注意到芯片上的小凹槽了吗，拿芯片的时候以这个为参考物就不会搞反了）
接口的常用命名方式有以下两种：
接口代号(编号) 说明 接口代号(编号) 说明 Q7&rsquo;(9) serial data output QH&rsquo; (9) serial data output MR (10) Master Reset (Active Low) SRCLR (10) Shift register CLeaR SH_CP (11) shift register clock input SRCLK (11) Shift Register CLocK input ST_CP (12) storage register clock input RCLK (12) storage Register CLocK input OE (13) output enable input (Active Low) OE (13) Output Enable DS (14) serial data input SER (14) SERial data input Qx (15，1-7) data output Qx (15，1-7) data output 控制流程 如果要在8个引脚输出01010101
<a href=https://blog.hugozhu.site/post/2013/34-use-74hc595-8-bit-shift-register-with-raspberry-pi/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/raspberry-pi/>Raspberry Pi</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.hugozhu.site/post/2013/33-use-google-app-engine-failover-your-blog-between-raspberrypi-and-github/><h2 class=post-title>树莓派网站容灾：利用DNSPod，Google App Engine和Github</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on April 22, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;286&nbsp;words</span></p><div class=post-entry>背景介绍 把网站托管在树莓派上后如果家里停电或是宽带故障，会造成网站中断。本文提供一个免费的解决方案（前提是你需要有自己的一个域名，并由DNSPod解析）
DNSPod 首先需要在DNSPod里设置好需要failover的域名CNAME：比如hugozhu.myalert.info
其中默认指向pi.myalert.info, 这是一个域名的A Record，会由运行在树莓派上的脚本来更新动态IP，国外则指向github。当停电时我们需要自动把｀默认｀这条纪录修改成github。
使用下面命令获得相应CNAME的domain_id：
curl -k https://dnsapi.cn/Domain.List -d "login_email=xxx&amp;login_password=xxx" 使用下面命令获得相应CNAME的record_id：
curl -k https://dnsapi.cn/Record.List -d "login_email=xxx&amp;login_password=xxx&amp;domain_id=xxx" Google App Engine 切换DNS脚本 package dnspod import ( "io/ioutil" "net/http" "net/url" "strings" ) const ( login_email = "&lt;your_login_email>" login_password = "&lt;your_login_password>" format = "json" domain_id = "&lt;domain_id>" record_id = "&lt;record_id>" sub_domain = "&lt;your_subdomain>" record_type = "CNAME" record_line = "默认" ttl = "600" ) func Update(client *http.Client, cname string) string { body := url.
<a href=https://blog.hugozhu.site/post/2013/33-use-google-app-engine-failover-your-blog-between-raspberrypi-and-github/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=https://blog.hugozhu.site/tags/golang/>Golang</a>&nbsp;
<a href=https://blog.hugozhu.site/tags/google-app-engine/>Google App Engine</a>&nbsp;</div></article></div><ul class="pager main-pager"><li class=previous><a href=https://blog.hugozhu.site/page/4/>&larr; Newer Posts</a></li><li class=next><a href=https://blog.hugozhu.site/page/6/>Older Posts &rarr;</a></li></ul></div></div></div><div class=page-meta></div><footer><div class=container><div class=row><div class=disclaimer><b>Disclaimer:</b> The opinions expressed herein are my own personal opinions and do not represent my company’s view in any way.</div></div><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:hugozhu@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.facebook.com/hugozhu title=Facebook><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/hugozhu title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/hugozhu title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://weibo.com/hugozhu title=Weibo><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-weibo fa-stack-1x fa-inverse"></i></span></a></li><li><a href=/index.xml title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=blog.hugozhu.site>Hugo Zhu</a>
&nbsp;&bull;&nbsp;&copy;
2025
&nbsp;&bull;&nbsp;
<a href=https://blog.hugozhu.site/>All about Raspberry Pi</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.128.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=https://blog.hugozhu.site/js/main.js></script><script src=https://blog.hugozhu.site/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://blog.hugozhu.site/js/load-photoswipe.js></script><script>(function(){var t,n="617d351a633194d48",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+n,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>$(function(){$("#show-comments").on("click",function(){var e="hugozhu";(function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)})(),$(this).hide()})})</script><script id=dsq-count-scr src=//hugozhu.disqus.com/count.js async></script></body></html>
<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>构建高质量订单文档分类器：智能导流到专业Agent - Hugo Zhu's Blog</title>
<meta name=description content="从意图识别到精准路由的完整解决方案"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"All about Raspberry Pi","url":"https:\/\/hugozhu.site\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/hugozhu.site\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/hugozhu.site\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/hugozhu.site\/post\/2025\/111-order-document-classifier-agent-routing\/","name":"构建高质量订单文档分类器：智能导流到专业 agent"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":""},"headline":"构建高质量订单文档分类器：智能导流到专业Agent","description":"在现代企业的订单处理流程中，不同类型的订单文档往往需要不同的处理逻辑和专业知识。传统的人工分类方式效率低下且容易出错，而基于规则的自动化系统又难以应对复杂多变的业务场景。本文将介绍如何利用大语言模型（LLM）构建一个高质量的订单文档分类器，实现智能路由到专业Agent的完整解决方案。\n","inLanguage":"en","wordCount":1761,"datePublished":"2025-12-20T00:00:00\u002b00:00","dateModified":"2025-12-20T00:00:00\u002b00:00","image":"https:\/\/hugozhu.site\/img\/pi.png","keywords":["AI, LLM, document-classification, agent-routing, NLP, prompt-engineering, workflow-automation"],"mainEntityOfPage":"https:\/\/hugozhu.site\/post\/2025\/111-order-document-classifier-agent-routing\/","publisher":{"@type":"Organization","name":"https:\/\/hugozhu.site\/","logo":{"@type":"ImageObject","url":"https:\/\/hugozhu.site\/img\/pi.png","height":60,"width":60}}}</script><meta property="og:title" content="构建高质量订单文档分类器：智能导流到专业Agent"><meta property="og:description" content="从意图识别到精准路由的完整解决方案"><meta property="og:image" content="https://hugozhu.site/img/pi.png"><meta property="og:url" content="https://hugozhu.site/post/2025/111-order-document-classifier-agent-routing/"><meta property="og:type" content="website"><meta property="og:site_name" content="All about Raspberry Pi"><meta name=twitter:title content="构建高质量订单文档分类器：智能导流到专业Agent"><meta name=twitter:description content="从意图识别到精准路由的完整解决方案"><meta name=twitter:image content="https://hugozhu.site/img/pi.png"><meta name=twitter:card content="summary_large_image"><link href=https://hugozhu.site/img/pi.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.145.0"><link rel=alternate href=https://hugozhu.site/index.xml type=application/rss+xml title="All about Raspberry Pi"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.6.0/css/all.css integrity=sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://hugozhu.site/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://hugozhu.site/css/highlight.min.css><link rel=stylesheet href=https://hugozhu.site/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-W88HDMN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-W88HDMN")}</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://hugozhu.site/>All about Raspberry Pi</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Tools</a><div class=navlinks-children><a href=https://nddapp.com/json-encoder.html>HTML Tools</a>
<a href=https://www.birme.net/>Imaeg Resizing</a>
<a href=https://jwt.io/>JWT Token Tool</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li><a href=#modalSearch data-toggle=modal data-target=#modalSearch style=outline:none><span class="hidden-sm hidden-md hidden-lg">Search</span> <span id=searchGlyph class="glyphicon glyphicon-search"></span></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="All about Raspberry Pi" href=https://hugozhu.site/><img class=avatar-img src=https://hugozhu.site/img/pi.png alt="All about Raspberry Pi"></a></div></div></div></nav><div id=modalSearch class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal>&#215;</button><h4 class=modal-title>Search All about Raspberry Pi</h4></div><div class=modal-body><gcse:search></gcse:search></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>Close</button></div></div></div></div><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>构建高质量订单文档分类器：智能导流到专业Agent</h1><h2 class=post-subheading>从意图识别到精准路由的完整解决方案</h2><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on December 20, 2025
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;9&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1761&nbsp;words</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><h4><i>目录:</i></h4><nav id=TableOfContents><ul><li><a href=#为什么需要文档分类器>为什么需要文档分类器</a></li><li><a href=#系统架构设计>系统架构设计</a></li><li><a href=#核心技术实现>核心技术实现</a><ul><li><a href=#1-文档预处理>1. 文档预处理</a></li><li><a href=#2-llm分类器核心实现>2. LLM分类器核心实现</a></li></ul></li><li><a href=#任务要求>任务要求</a></li></ul><ul><li><ul><li><a href=#4-agent路由器实现>4. Agent路由器实现</a></li><li><a href=#5-完整流程编排>5. 完整流程编排</a></li></ul></li><li><a href=#最佳实践与优化建议>最佳实践与优化建议</a><ul><li><a href=#1-提示词工程>1. 提示词工程</a></li><li><a href=#2-few-shot-learning>2. Few-shot Learning</a></li><li><a href=#3-多模型集成>3. 多模型集成</a></li><li><a href=#4-持续学习与优化>4. 持续学习与优化</a></li><li><a href=#5-性能优化>5. 性能优化</a></li></ul></li><li><a href=#监控与可观测性>监控与可观测性</a></li><li><a href=#总结>总结</a></li><li><a href=#延伸阅读>延伸阅读</a></li></ul></nav><p>在现代企业的订单处理流程中，不同类型的订单文档往往需要不同的处理逻辑和专业知识。传统的人工分类方式效率低下且容易出错，而基于规则的自动化系统又难以应对复杂多变的业务场景。本文将介绍如何利用大语言模型（LLM）构建一个高质量的订单文档分类器，实现智能路由到专业Agent的完整解决方案。</p><h2 id=为什么需要文档分类器>为什么需要文档分类器</h2><p>在实际业务场景中，订单文档可能包含多种类型：</p><ul><li><strong>标准采购订单</strong>：常规商品采购，遵循标准流程</li><li><strong>定制化订单</strong>：需要特殊定制的产品或服务</li><li><strong>退货/换货订单</strong>：逆向物流处理</li><li><strong>紧急订单</strong>：需要加急处理的高优先级订单</li><li><strong>批量订单</strong>：大宗采购，涉及特殊定价和物流</li><li><strong>国际订单</strong>：跨境交易，涉及海关和汇率</li></ul><p>每种订单类型都需要不同的处理流程、审批权限和专业知识。一个高质量的分类器能够：</p><ol><li><strong>提升效率</strong>：自动路由减少人工干预</li><li><strong>降低错误率</strong>：专业Agent处理对应领域问题</li><li><strong>优化资源分配</strong>：将复杂任务分配给最合适的处理者</li><li><strong>提升客户体验</strong>：更快的响应时间和更准确的处理</li></ol><h2 id=系统架构设计>系统架构设计</h2><p>一个完整的订单文档分类与路由系统通常包含以下核心组件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────┐
</span></span><span class=line><span class=cl>│  订单文档输入    │
</span></span><span class=line><span class=cl>└────────┬────────┘
</span></span><span class=line><span class=cl>         │
</span></span><span class=line><span class=cl>         ▼
</span></span><span class=line><span class=cl>┌─────────────────┐
</span></span><span class=line><span class=cl>│  文档预处理      │  ← 提取关键信息、格式标准化
</span></span><span class=line><span class=cl>└────────┬────────┘
</span></span><span class=line><span class=cl>         │
</span></span><span class=line><span class=cl>         ▼
</span></span><span class=line><span class=cl>┌─────────────────┐
</span></span><span class=line><span class=cl>│  LLM分类器      │  ← 核心分类逻辑
</span></span><span class=line><span class=cl>└────────┬────────┘
</span></span><span class=line><span class=cl>         │
</span></span><span class=line><span class=cl>         ▼
</span></span><span class=line><span class=cl>┌─────────────────┐
</span></span><span class=line><span class=cl>│  置信度评估      │  ← 判断分类可靠性
</span></span><span class=line><span class=cl>└────────┬────────┘
</span></span><span class=line><span class=cl>         │
</span></span><span class=line><span class=cl>    ┌────┴────┐
</span></span><span class=line><span class=cl>    │         │
</span></span><span class=line><span class=cl>    ▼         ▼
</span></span><span class=line><span class=cl> 高置信度   低置信度
</span></span><span class=line><span class=cl>    │         │
</span></span><span class=line><span class=cl>    │         ▼
</span></span><span class=line><span class=cl>    │    ┌─────────────┐
</span></span><span class=line><span class=cl>    │    │ 人工复核队列 │
</span></span><span class=line><span class=cl>    │    └─────────────┘
</span></span><span class=line><span class=cl>    │
</span></span><span class=line><span class=cl>    ▼
</span></span><span class=line><span class=cl>┌─────────────────────────────────────┐
</span></span><span class=line><span class=cl>│        Agent路由器                   │
</span></span><span class=line><span class=cl>├─────────────────────────────────────┤
</span></span><span class=line><span class=cl>│  • 标准订单Agent                     │
</span></span><span class=line><span class=cl>│  • 定制订单Agent                     │
</span></span><span class=line><span class=cl>│  • 退货处理Agent                     │
</span></span><span class=line><span class=cl>│  • 紧急订单Agent                     │
</span></span><span class=line><span class=cl>│  • 批量订单Agent                     │
</span></span><span class=line><span class=cl>│  • 国际订单Agent                     │
</span></span><span class=line><span class=cl>└─────────────────────────────────────┘
</span></span></code></pre></div><h2 id=核心技术实现>核心技术实现</h2><h3 id=1-文档预处理>1. 文档预处理</h3><p>在送入分类器之前，需要对订单文档进行标准化处理：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderDocumentPreprocessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;订单文档预处理器&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key_fields</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_id&#39;</span><span class=p>,</span> <span class=s1>&#39;customer_name&#39;</span><span class=p>,</span> <span class=s1>&#39;items&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_amount&#39;</span><span class=p>,</span> <span class=s1>&#39;shipping_address&#39;</span><span class=p>,</span> <span class=s1>&#39;special_requirements&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_structured_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>raw_document</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        从原始文档中提取结构化数据
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            raw_document: 原始订单文档文本
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            结构化的订单数据字典
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>structured_data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 提取订单号</span>
</span></span><span class=line><span class=cl>        <span class=n>order_id_match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;订单号[:：]\s*(\w+)&#39;</span><span class=p>,</span> <span class=n>raw_document</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>order_id_match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>structured_data</span><span class=p>[</span><span class=s1>&#39;order_id&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>order_id_match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 提取金额信息</span>
</span></span><span class=line><span class=cl>        <span class=n>amount_match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;总金额[:：]\s*¥?([\d,]+\.?\d*)&#39;</span><span class=p>,</span> <span class=n>raw_document</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>amount_match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>amount_str</span> <span class=o>=</span> <span class=n>amount_match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>structured_data</span><span class=p>[</span><span class=s1>&#39;total_amount&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>amount_str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 检测关键词</span>
</span></span><span class=line><span class=cl>        <span class=n>structured_data</span><span class=p>[</span><span class=s1>&#39;keywords&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_extract_keywords</span><span class=p>(</span><span class=n>raw_document</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 检测紧急程度</span>
</span></span><span class=line><span class=cl>        <span class=n>structured_data</span><span class=p>[</span><span class=s1>&#39;is_urgent&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_detect_urgency</span><span class=p>(</span><span class=n>raw_document</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 检测是否国际订单</span>
</span></span><span class=line><span class=cl>        <span class=n>structured_data</span><span class=p>[</span><span class=s1>&#39;is_international&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_detect_international</span><span class=p>(</span><span class=n>raw_document</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>structured_data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_extract_keywords</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;提取关键特征词&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>keywords</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 定制化关键词</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;定制|客制化|个性化|特殊要求&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>keywords</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;customization&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 退货关键词</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;退货|退款|换货|退回&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>keywords</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;return&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 批量关键词</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;批量|大宗|批发|整批&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>keywords</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;bulk&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>keywords</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_detect_urgency</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;检测是否紧急订单&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>urgent_patterns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=sa>r</span><span class=s1>&#39;紧急&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;加急&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;特急&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;URGENT&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;ASAP&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=sa>r</span><span class=s1>&#39;立即&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;马上&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;尽快&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>any</span><span class=p>(</span><span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>text</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>IGNORECASE</span><span class=p>)</span> <span class=k>for</span> <span class=n>pattern</span> <span class=ow>in</span> <span class=n>urgent_patterns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_detect_international</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;检测是否国际订单&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>international_indicators</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=sa>r</span><span class=s1>&#39;国际&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;海外&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;出口&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;进口&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;跨境&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=sa>r</span><span class=s1>&#39;关税&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;清关&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;international&#39;</span><span class=p>,</span> <span class=sa>r</span><span class=s1>&#39;overseas&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>any</span><span class=p>(</span><span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>text</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>IGNORECASE</span><span class=p>)</span> <span class=k>for</span> <span class=n>pattern</span> <span class=ow>in</span> <span class=n>international_indicators</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generated by AI</span>
</span></span></code></pre></div><h3 id=2-llm分类器核心实现>2. LLM分类器核心实现</h3><p>使用LLM进行分类的关键在于设计高质量的提示词（Prompt）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Tuple</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>anthropic</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderClassifier</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;基于LLM的订单文档分类器&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 定义订单类型</span>
</span></span><span class=line><span class=cl>    <span class=n>ORDER_TYPES</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;standard&#39;</span><span class=p>:</span> <span class=s1>&#39;标准采购订单&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;customized&#39;</span><span class=p>:</span> <span class=s1>&#39;定制化订单&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;return&#39;</span><span class=p>:</span> <span class=s1>&#39;退货/换货订单&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;urgent&#39;</span><span class=p>:</span> <span class=s1>&#39;紧急订单&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;bulk&#39;</span><span class=p>:</span> <span class=s1>&#39;批量订单&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;international&#39;</span><span class=p>:</span> <span class=s1>&#39;国际订单&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;claude-3-5-sonnet-20241022&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>anthropic</span><span class=o>.</span><span class=n>Anthropic</span><span class=p>(</span><span class=n>api_key</span><span class=o>=</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>classify</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        对订单文档进行分类
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            document: 原始订单文档
</span></span></span><span class=line><span class=cl><span class=s2>            structured_data: 预处理后的结构化数据
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            (order_type, confidence, reasoning): 订单类型、置信度、推理过程
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>prompt</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_build_classification_prompt</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>1024</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>messages</span><span class=o>=</span><span class=p>[{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>prompt</span>
</span></span><span class=line><span class=cl>            <span class=p>}]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 解析响应</span>
</span></span><span class=line><span class=cl>        <span class=n>response_text</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_classification_result</span><span class=p>(</span><span class=n>response_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_build_classification_prompt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;构建分类提示词&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>prompt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;你是一个专业的订单文档分类专家。请仔细分析以下订单文档，并将其分类到最合适的类别中。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>## 订单类型定义
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>1. **标准采购订单** (standard)
</span></span></span><span class=line><span class=cl><span class=s2>   - 常规商品采购
</span></span></span><span class=line><span class=cl><span class=s2>   - 遵循标准流程
</span></span></span><span class=line><span class=cl><span class=s2>   - 无特殊要求
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>2. **定制化订单** (customized)
</span></span></span><span class=line><span class=cl><span class=s2>   - 需要产品定制
</span></span></span><span class=line><span class=cl><span class=s2>   - 有特殊规格要求
</span></span></span><span class=line><span class=cl><span class=s2>   - 非标准产品
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>3. **退货/换货订单** (return)
</span></span></span><span class=line><span class=cl><span class=s2>   - 商品退回
</span></span></span><span class=line><span class=cl><span class=s2>   - 换货请求
</span></span></span><span class=line><span class=cl><span class=s2>   - 售后处理
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>4. **紧急订单** (urgent)
</span></span></span><span class=line><span class=cl><span class=s2>   - 需要加急处理
</span></span></span><span class=line><span class=cl><span class=s2>   - 有明确的紧急时间要求
</span></span></span><span class=line><span class=cl><span class=s2>   - 高优先级
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>5. **批量订单** (bulk)
</span></span></span><span class=line><span class=cl><span class=s2>   - 大批量采购
</span></span></span><span class=line><span class=cl><span class=s2>   - 涉及特殊定价
</span></span></span><span class=line><span class=cl><span class=s2>   - 可能需要特殊物流
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>6. **国际订单** (international)
</span></span></span><span class=line><span class=cl><span class=s2>   - 跨境交易
</span></span></span><span class=line><span class=cl><span class=s2>   - 涉及海关清关
</span></span></span><span class=line><span class=cl><span class=s2>   - 需要处理汇率和国际物流
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>## 订单文档
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=si>{</span><span class=n>document</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>## 预提取的结构化信息
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>```json
</span></span></span><span class=line><span class=cl><span class=s2></span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>structured_data</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>
</span></span></span></code></pre></div><h2 id=任务要求>任务要求</h2><p>请分析上述订单文档，并按照以下JSON格式返回分类结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=err>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;order_type&#34;</span><span class=p>:</span> <span class=s2>&#34;订单类型代码 (standard/customized/return/urgent/bulk/international)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;confidence&#34;</span><span class=p>:</span> <span class=mf>0.0-1.0</span><span class=err>之间的置信度分数</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;reasoning&#34;</span><span class=p>:</span> <span class=s2>&#34;详细的分类推理过程，说明为什么选择这个类别&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key_factors&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;关键判断因素1&#34;</span><span class=p>,</span> <span class=s2>&#34;关键判断因素2&#34;</span><span class=p>,</span> <span class=err>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=err>}</span>
</span></span></code></pre></div><p>注意：</p><ul><li><p>如果订单同时符合多个类型，选择最主要的特征类型</p></li><li><p>紧急订单和国际订单具有更高的优先级</p></li><li><p>置信度应该反映你对分类结果的确定程度</p></li><li><p>推理过程要具体，引用文档中的关键信息
"""
return prompt</p><p>def _parse_classification_result(self, response: str) -> Tuple[str, float, str]:
&ldquo;&ldquo;&ldquo;解析LLM返回的分类结果&rdquo;&rdquo;&rdquo;
try:
# 提取JSON部分
json_match = re.search(r&rsquo;{[\s\S]*}&rsquo;, response)
if json_match:
result = json.loads(json_match.group())
return (
result[&lsquo;order_type&rsquo;],
float(result[&lsquo;confidence&rsquo;]),
result[&lsquo;reasoning&rsquo;]
)
else:
# 如果无法解析，返回默认值
return (&lsquo;standard&rsquo;, 0.5, &lsquo;无法解析分类结果&rsquo;)
except Exception as e:
print(f"解析错误: {e}")
return (&lsquo;standard&rsquo;, 0.3, f&rsquo;解析失败: {str(e)}&rsquo;)</p></li></ul><h1 id=generated-by-ai>generated by AI</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### 3. 置信度评估与人工复核
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>并非所有分类结果都需要相同的处理方式。设置合理的置信度阈值可以平衡自动化程度和准确率：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```python
</span></span><span class=line><span class=cl>class ConfidenceEvaluator:
</span></span><span class=line><span class=cl>    &#34;&#34;&#34;置信度评估器&#34;&#34;&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def __init__(self, auto_route_threshold: float = 0.85, manual_review_threshold: float = 0.60):
</span></span><span class=line><span class=cl>        self.auto_route_threshold = auto_route_threshold
</span></span><span class=line><span class=cl>        self.manual_review_threshold = manual_review_threshold
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def evaluate(self, order_type: str, confidence: float, structured_data: Dict[str, Any]) -&gt; str:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        评估分类结果并决定处理策略
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        Args:
</span></span><span class=line><span class=cl>            order_type: 分类的订单类型
</span></span><span class=line><span class=cl>            confidence: LLM给出的置信度
</span></span><span class=line><span class=cl>            structured_data: 订单结构化数据
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        Returns:
</span></span><span class=line><span class=cl>            处理策略: &#39;auto_route&#39;, &#39;manual_review&#39;, 或 &#39;reject&#39;
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        # 高置信度：直接自动路由
</span></span><span class=line><span class=cl>        if confidence &gt;= self.auto_route_threshold:
</span></span><span class=line><span class=cl>            return &#39;auto_route&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # 中等置信度：考虑订单金额等因素
</span></span><span class=line><span class=cl>        elif confidence &gt;= self.manual_review_threshold:
</span></span><span class=line><span class=cl>            # 高价值订单即使中等置信度也需要人工复核
</span></span><span class=line><span class=cl>            if structured_data.get(&#39;total_amount&#39;, 0) &gt; 100000:
</span></span><span class=line><span class=cl>                return &#39;manual_review&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            # 国际订单涉及复杂流程，建议人工复核
</span></span><span class=line><span class=cl>            if structured_data.get(&#39;is_international&#39;, False):
</span></span><span class=line><span class=cl>                return &#39;manual_review&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            # 其他中等置信度情况可以自动路由
</span></span><span class=line><span class=cl>            return &#39;auto_route&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # 低置信度：必须人工复核
</span></span><span class=line><span class=cl>        else:
</span></span><span class=line><span class=cl>            return &#39;manual_review&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def get_review_priority(self, order_type: str, confidence: float, structured_data: Dict[str, Any]) -&gt; int:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        计算人工复核的优先级（1-5，5最高）
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        priority = 3  # 默认中等优先级
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # 紧急订单提高优先级
</span></span><span class=line><span class=cl>        if structured_data.get(&#39;is_urgent&#39;, False):
</span></span><span class=line><span class=cl>            priority += 2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # 低置信度提高优先级
</span></span><span class=line><span class=cl>        if confidence &lt; 0.5:
</span></span><span class=line><span class=cl>            priority += 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # 高金额提高优先级
</span></span><span class=line><span class=cl>        if structured_data.get(&#39;total_amount&#39;, 0) &gt; 50000:
</span></span><span class=line><span class=cl>            priority += 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        return min(priority, 5)  # 最高5级
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># generated by AI
</span></span></code></pre></div><h3 id=4-agent路由器实现>4. Agent路由器实现</h3><p>分类完成后，需要将订单路由到对应的专业Agent：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Protocol</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderAgent</span><span class=p>(</span><span class=n>Protocol</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;订单处理Agent接口&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>can_handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;判断是否能处理该类型订单&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;处理订单&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AgentRouter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Agent路由器&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>agents</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>OrderAgent</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fallback_agent</span><span class=p>:</span> <span class=n>OrderAgent</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>register_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=n>OrderAgent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;注册专业Agent&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>agents</span><span class=p>[</span><span class=n>order_type</span><span class=p>]</span> <span class=o>=</span> <span class=n>agent</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;已注册 </span><span class=si>{</span><span class=n>order_type</span><span class=si>}</span><span class=s2> 类型的Agent&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_fallback_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=n>OrderAgent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;设置默认/兜底Agent&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fallback_agent</span> <span class=o>=</span> <span class=n>agent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>route</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        路由订单到对应的Agent
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            order_type: 订单类型
</span></span></span><span class=line><span class=cl><span class=s2>            document: 原始文档
</span></span></span><span class=line><span class=cl><span class=s2>            structured_data: 结构化数据
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            处理结果
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>agent</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>agents</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>order_type</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>fallback_agent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>agent</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;没有找到处理 </span><span class=si>{</span><span class=n>order_type</span><span class=si>}</span><span class=s2> 类型订单的Agent，且未设置fallback agent&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;路由订单到 </span><span class=si>{</span><span class=n>order_type</span><span class=si>}</span><span class=s2> Agent...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>agent</span><span class=o>.</span><span class=n>process</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;order_type&#39;</span><span class=p>:</span> <span class=n>order_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;agent&#39;</span><span class=p>:</span> <span class=n>agent</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;processing_result&#39;</span><span class=p>:</span> <span class=n>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 示例：标准订单Agent</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>StandardOrderAgent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;标准订单处理Agent&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>can_handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_type</span> <span class=o>==</span> <span class=s1>&#39;standard&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;处理标准订单&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;处理标准订单...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 验证库存</span>
</span></span><span class=line><span class=cl>        <span class=n>inventory_check</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_check_inventory</span><span class=p>(</span><span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 计算价格</span>
</span></span><span class=line><span class=cl>        <span class=n>pricing</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calculate_pricing</span><span class=p>(</span><span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 安排物流</span>
</span></span><span class=line><span class=cl>        <span class=n>shipping</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_arrange_shipping</span><span class=p>(</span><span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;processed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;inventory_check&#39;</span><span class=p>:</span> <span class=n>inventory_check</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;pricing&#39;</span><span class=p>:</span> <span class=n>pricing</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;shipping&#39;</span><span class=p>:</span> <span class=n>shipping</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_check_inventory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;检查库存（示例）&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;available&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s1>&#39;estimated_ship_date&#39;</span><span class=p>:</span> <span class=s1>&#39;2025-12-22&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_calculate_pricing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;计算价格（示例）&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>amount</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;total_amount&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>amount</span><span class=p>,</span> <span class=s1>&#39;discount&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;final_amount&#39;</span><span class=p>:</span> <span class=n>amount</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_arrange_shipping</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;安排物流（示例）&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;carrier&#39;</span><span class=p>:</span> <span class=s1>&#39;顺丰速运&#39;</span><span class=p>,</span> <span class=s1>&#39;estimated_delivery&#39;</span><span class=p>:</span> <span class=s1>&#39;2-3工作日&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 示例：定制订单Agent</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CustomizedOrderAgent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;定制订单处理Agent&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>can_handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>order_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>order_type</span> <span class=o>==</span> <span class=s1>&#39;customized&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;处理定制订单&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;处理定制订单...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 评估定制需求</span>
</span></span><span class=line><span class=cl>        <span class=n>requirements</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_evaluate_requirements</span><span class=p>(</span><span class=n>document</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 生成报价</span>
</span></span><span class=line><span class=cl>        <span class=n>quotation</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_generate_quotation</span><span class=p>(</span><span class=n>requirements</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 评估生产周期</span>
</span></span><span class=line><span class=cl>        <span class=n>production_time</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_estimate_production_time</span><span class=p>(</span><span class=n>requirements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;requires_confirmation&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;requirements&#39;</span><span class=p>:</span> <span class=n>requirements</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;quotation&#39;</span><span class=p>:</span> <span class=n>quotation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;production_time&#39;</span><span class=p>:</span> <span class=n>production_time</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_evaluate_requirements</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;评估定制需求（示例）&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;complexity&#39;</span><span class=p>:</span> <span class=s1>&#39;medium&#39;</span><span class=p>,</span> <span class=s1>&#39;feasibility&#39;</span><span class=p>:</span> <span class=s1>&#39;high&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_generate_quotation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>requirements</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;生成报价（示例）&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>base_amount</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;total_amount&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>customization_fee</span> <span class=o>=</span> <span class=n>base_amount</span> <span class=o>*</span> <span class=mf>0.3</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;base&#39;</span><span class=p>:</span> <span class=n>base_amount</span><span class=p>,</span> <span class=s1>&#39;customization_fee&#39;</span><span class=p>:</span> <span class=n>customization_fee</span><span class=p>,</span> <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>base_amount</span> <span class=o>+</span> <span class=n>customization_fee</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_estimate_production_time</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>requirements</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;评估生产周期（示例）&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;15-20工作日&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generated by AI</span>
</span></span></code></pre></div><h3 id=5-完整流程编排>5. 完整流程编排</h3><p>将所有组件整合到一起：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>OrderProcessingPipeline</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;订单处理流水线&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>preprocessor</span> <span class=o>=</span> <span class=n>OrderDocumentPreprocessor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>classifier</span> <span class=o>=</span> <span class=n>OrderClassifier</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>confidence_evaluator</span> <span class=o>=</span> <span class=n>ConfidenceEvaluator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>router</span> <span class=o>=</span> <span class=n>AgentRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 注册各类Agent</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_setup_agents</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_setup_agents</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;初始化并注册所有Agent&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>register_agent</span><span class=p>(</span><span class=s1>&#39;standard&#39;</span><span class=p>,</span> <span class=n>StandardOrderAgent</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>register_agent</span><span class=p>(</span><span class=s1>&#39;customized&#39;</span><span class=p>,</span> <span class=n>CustomizedOrderAgent</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=c1># 注册其他Agent...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 设置fallback agent</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>set_fallback_agent</span><span class=p>(</span><span class=n>StandardOrderAgent</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>raw_document</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        完整的订单处理流程
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            raw_document: 原始订单文档
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            处理结果
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 步骤1: 预处理</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;步骤1: 预处理订单文档...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>structured_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>preprocessor</span><span class=o>.</span><span class=n>extract_structured_data</span><span class=p>(</span><span class=n>raw_document</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 步骤2: 分类</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;步骤2: 分类订单类型...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>order_type</span><span class=p>,</span> <span class=n>confidence</span><span class=p>,</span> <span class=n>reasoning</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>classifier</span><span class=o>.</span><span class=n>classify</span><span class=p>(</span><span class=n>raw_document</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  分类结果: </span><span class=si>{</span><span class=n>order_type</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  置信度: </span><span class=si>{</span><span class=n>confidence</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  推理: </span><span class=si>{</span><span class=n>reasoning</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 步骤3: 置信度评估</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;步骤3: 评估置信度...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>strategy</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>confidence_evaluator</span><span class=o>.</span><span class=n>evaluate</span><span class=p>(</span><span class=n>order_type</span><span class=p>,</span> <span class=n>confidence</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  处理策略: </span><span class=si>{</span><span class=n>strategy</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 步骤4: 根据策略处理</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>strategy</span> <span class=o>==</span> <span class=s1>&#39;manual_review&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>priority</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>confidence_evaluator</span><span class=o>.</span><span class=n>get_review_priority</span><span class=p>(</span><span class=n>order_type</span><span class=p>,</span> <span class=n>confidence</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;pending_review&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;order_type&#39;</span><span class=p>:</span> <span class=n>order_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;confidence&#39;</span><span class=p>:</span> <span class=n>confidence</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;review_priority&#39;</span><span class=p>:</span> <span class=n>priority</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;reasoning&#39;</span><span class=p>:</span> <span class=n>reasoning</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 步骤5: 自动路由到Agent</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;步骤4: 路由到专业Agent...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>router</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=n>order_type</span><span class=p>,</span> <span class=n>raw_document</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;auto_processed&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;classification&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;order_type&#39;</span><span class=p>:</span> <span class=n>order_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;confidence&#39;</span><span class=p>:</span> <span class=n>confidence</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;reasoning&#39;</span><span class=p>:</span> <span class=n>reasoning</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;processing&#39;</span><span class=p>:</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用示例</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 示例订单文档</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_order</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    订单号: ORD-2025-12345
</span></span></span><span class=line><span class=cl><span class=s2>    客户名称: 张三科技有限公司
</span></span></span><span class=line><span class=cl><span class=s2>    订单日期: 2025-12-20
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    订单内容:
</span></span></span><span class=line><span class=cl><span class=s2>    - 产品A x 100件
</span></span></span><span class=line><span class=cl><span class=s2>    - 产品B x 50件
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    总金额: ¥58,000
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    特殊要求: 需要在产品A上印制公司Logo
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    配送地址: 上海市浦东新区XX路XX号
</span></span></span><span class=line><span class=cl><span class=s2>    联系电话: 138-1234-5678
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 初始化处理流水线</span>
</span></span><span class=line><span class=cl>    <span class=n>pipeline</span> <span class=o>=</span> <span class=n>OrderProcessingPipeline</span><span class=p>(</span><span class=n>api_key</span><span class=o>=</span><span class=s2>&#34;your-api-key&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 处理订单</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>pipeline</span><span class=o>.</span><span class=n>process</span><span class=p>(</span><span class=n>sample_order</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>===== 最终结果 =====&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generated by AI</span>
</span></span></code></pre></div><h2 id=最佳实践与优化建议>最佳实践与优化建议</h2><h3 id=1-提示词工程>1. 提示词工程</h3><ul><li><strong>明确类型定义</strong>：为每个订单类型提供清晰、具体的定义和示例</li><li><strong>提供上下文</strong>：包含业务背景和领域知识</li><li><strong>要求结构化输出</strong>：使用JSON格式便于解析</li><li><strong>要求推理过程</strong>：让模型解释分类依据，提高可解释性</li></ul><h3 id=2-few-shot-learning>2. Few-shot Learning</h3><p>对于特定领域或复杂场景，可以在提示词中加入示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_build_classification_prompt_with_examples</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>examples</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>## 分类示例
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>### 示例1: 定制化订单
</span></span></span><span class=line><span class=cl><span class=s2>文档: &#34;订单号：001，需要在T恤上印制特定图案，尺寸为XXL，数量100件&#34;
</span></span></span><span class=line><span class=cl><span class=s2>分类: customized
</span></span></span><span class=line><span class=cl><span class=s2>原因: 明确提到&#34;印制特定图案&#34;，属于产品定制需求
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>### 示例2: 紧急订单
</span></span></span><span class=line><span class=cl><span class=s2>文档: &#34;订单号：002，标准商品100件，总金额5000元，备注：需要明天发货，加急！&#34;
</span></span></span><span class=line><span class=cl><span class=s2>分类: urgent
</span></span></span><span class=line><span class=cl><span class=s2>原因: 明确要求&#34;明天发货&#34;和&#34;加急&#34;标识
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>### 示例3: 批量订单
</span></span></span><span class=line><span class=cl><span class=s2>文档: &#34;订单号：003，批发采购标准商品5000件，总金额50万元，需要特殊报价&#34;
</span></span></span><span class=line><span class=cl><span class=s2>分类: bulk
</span></span></span><span class=line><span class=cl><span class=s2>原因: 数量大（5000件）、金额高（50万），且提到&#34;批发&#34;和&#34;特殊报价&#34;
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 将examples插入到prompt中</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>examples</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\n\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;现在请分类以下订单：</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=n>document</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generated by AI</span>
</span></span></code></pre></div><h3 id=3-多模型集成>3. 多模型集成</h3><p>对于关键业务，可以使用多个模型进行ensemble：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EnsembleClassifier</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;集成分类器&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>classifiers</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>OrderClassifier</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>classifiers</span> <span class=o>=</span> <span class=n>classifiers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>classify</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;使用多个分类器进行投票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>classifier</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>classifiers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>order_type</span><span class=p>,</span> <span class=n>confidence</span><span class=p>,</span> <span class=n>reasoning</span> <span class=o>=</span> <span class=n>classifier</span><span class=o>.</span><span class=n>classify</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=n>structured_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>order_type</span><span class=p>,</span> <span class=n>confidence</span><span class=p>,</span> <span class=n>reasoning</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 投票决策</span>
</span></span><span class=line><span class=cl>        <span class=n>type_votes</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>order_type</span><span class=p>,</span> <span class=n>confidence</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>order_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>type_votes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>type_votes</span><span class=p>[</span><span class=n>order_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=n>type_votes</span><span class=p>[</span><span class=n>order_type</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>confidence</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 选择得票最多且平均置信度最高的类型</span>
</span></span><span class=line><span class=cl>        <span class=n>best_type</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>type_votes</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span> <span class=nb>sum</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>/</span><span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])))[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>avg_confidence</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>type_votes</span><span class=p>[</span><span class=n>best_type</span><span class=p>])</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>type_votes</span><span class=p>[</span><span class=n>best_type</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>best_type</span><span class=p>,</span> <span class=n>avg_confidence</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;集成分类结果，基于</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>classifiers</span><span class=p>)</span><span class=si>}</span><span class=s2>个模型&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generated by AI</span>
</span></span></code></pre></div><h3 id=4-持续学习与优化>4. 持续学习与优化</h3><p>建立反馈循环，不断优化分类器性能：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>ClassificationFeedbackSystem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分类反馈系统&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>db_connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db</span> <span class=o>=</span> <span class=n>db_connection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_classification</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>predicted_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>confidence</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>actual_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;记录分类结果和实际标签&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>insert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;document&#39;</span><span class=p>:</span> <span class=n>document</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;predicted_type&#39;</span><span class=p>:</span> <span class=n>predicted_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;confidence&#39;</span><span class=p>:</span> <span class=n>confidence</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;actual_type&#39;</span><span class=p>:</span> <span class=n>actual_type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;correct&#39;</span><span class=p>:</span> <span class=n>predicted_type</span> <span class=o>==</span> <span class=n>actual_type</span> <span class=k>if</span> <span class=n>actual_type</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_accuracy_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;计算准确率指标&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>records</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM classifications WHERE actual_type IS NOT NULL&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>total</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>records</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>correct</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>records</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;correct&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 按类型统计</span>
</span></span><span class=line><span class=cl>        <span class=n>type_metrics</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>order_type</span> <span class=ow>in</span> <span class=n>OrderClassifier</span><span class=o>.</span><span class=n>ORDER_TYPES</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>type_records</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>records</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;predicted_type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>order_type</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>type_records</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>type_correct</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>type_records</span> <span class=k>if</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;correct&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>type_metrics</span><span class=p>[</span><span class=n>order_type</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;accuracy&#39;</span><span class=p>:</span> <span class=n>type_correct</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>type_records</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>type_records</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;overall_accuracy&#39;</span><span class=p>:</span> <span class=n>correct</span> <span class=o>/</span> <span class=n>total</span> <span class=k>if</span> <span class=n>total</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_classifications&#39;</span><span class=p>:</span> <span class=n>total</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;type_metrics&#39;</span><span class=p>:</span> <span class=n>type_metrics</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>identify_improvement_areas</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;识别需要改进的领域&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_accuracy_metrics</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>improvement_areas</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>order_type</span><span class=p>,</span> <span class=n>stats</span> <span class=ow>in</span> <span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;type_metrics&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>stats</span><span class=p>[</span><span class=s1>&#39;accuracy&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mf>0.85</span><span class=p>:</span>  <span class=c1># 准确率阈值</span>
</span></span><span class=line><span class=cl>                <span class=n>improvement_areas</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>order_type</span><span class=si>}</span><span class=s2>: 准确率 </span><span class=si>{</span><span class=n>stats</span><span class=p>[</span><span class=s1>&#39;accuracy&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2%</span><span class=si>}</span><span class=s2>，需要优化&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>improvement_areas</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generated by AI</span>
</span></span></code></pre></div><h3 id=5-性能优化>5. 性能优化</h3><p>对于高吞吐量场景，考虑以下优化：</p><ul><li><strong>批处理</strong>：将多个订单合并为一次API调用</li><li><strong>缓存</strong>：对于相似文档，缓存分类结果</li><li><strong>异步处理</strong>：使用消息队列解耦分类和路由</li><li><strong>模型选择</strong>：根据延迟要求选择合适规模的模型</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AsyncOrderClassifier</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;异步订单分类器&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>classify_batch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>documents</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;批量异步分类&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>classify_async</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>documents</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>classify_async</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>document</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;单个文档异步分类&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 实现异步分类逻辑</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generated by AI</span>
</span></span></code></pre></div><h2 id=监控与可观测性>监控与可观测性</h2><p>生产环境中，需要建立完善的监控体系：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Optional</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ClassificationMetrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;分类指标&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>document_id</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>order_type</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>confidence</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>processing_time</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>    <span class=n>strategy</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span><span class=p>:</span> <span class=nb>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MetricsCollector</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;指标收集器&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ClassificationMetrics</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>record_classification</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metric</span><span class=p>:</span> <span class=n>ClassificationMetrics</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;记录分类指标&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>metric</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 实时监控</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_check_alerts</span><span class=p>(</span><span class=n>metric</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_check_alerts</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metric</span><span class=p>:</span> <span class=n>ClassificationMetrics</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;检查告警条件&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 低置信度告警</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>metric</span><span class=o>.</span><span class=n>confidence</span> <span class=o>&lt;</span> <span class=mf>0.6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_send_alert</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;低置信度分类: </span><span class=si>{</span><span class=n>metric</span><span class=o>.</span><span class=n>order_type</span><span class=si>}</span><span class=s2>, 置信度: </span><span class=si>{</span><span class=n>metric</span><span class=o>.</span><span class=n>confidence</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 处理时间告警</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>metric</span><span class=o>.</span><span class=n>processing_time</span> <span class=o>&gt;</span> <span class=mf>5.0</span><span class=p>:</span>  <span class=c1># 5秒</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_send_alert</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;分类耗时过长: </span><span class=si>{</span><span class=n>metric</span><span class=o>.</span><span class=n>processing_time</span><span class=si>}</span><span class=s2>秒&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_send_alert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;发送告警&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[ALERT] </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 实际应该集成到告警系统</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_summary</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>time_window</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3600</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;获取指标摘要&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>now</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>recent_metrics</span> <span class=o>=</span> <span class=p>[</span><span class=n>m</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=k>if</span> <span class=n>now</span> <span class=o>-</span> <span class=n>m</span><span class=o>.</span><span class=n>timestamp</span> <span class=o>&lt;</span> <span class=n>time_window</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>recent_metrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;total_classifications&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_metrics</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;avg_confidence&#39;</span><span class=p>:</span> <span class=nb>sum</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>confidence</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>recent_metrics</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_metrics</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;avg_processing_time&#39;</span><span class=p>:</span> <span class=nb>sum</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>processing_time</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>recent_metrics</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_metrics</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;auto_route_rate&#39;</span><span class=p>:</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>recent_metrics</span> <span class=k>if</span> <span class=n>m</span><span class=o>.</span><span class=n>strategy</span> <span class=o>==</span> <span class=s1>&#39;auto_route&#39;</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_metrics</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;type_distribution&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_type_distribution</span><span class=p>(</span><span class=n>recent_metrics</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_type_distribution</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metrics</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ClassificationMetrics</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;获取类型分布&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>distribution</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>metric</span> <span class=ow>in</span> <span class=n>metrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>distribution</span><span class=p>[</span><span class=n>metric</span><span class=o>.</span><span class=n>order_type</span><span class=p>]</span> <span class=o>=</span> <span class=n>distribution</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>metric</span><span class=o>.</span><span class=n>order_type</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>distribution</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generated by AI</span>
</span></span></code></pre></div><h2 id=总结>总结</h2><p>构建高质量的订单文档分类器需要综合考虑多个方面：</p><ol><li><strong>准确性</strong>：通过精心设计的提示词、预处理和后处理提升分类准确率</li><li><strong>可靠性</strong>：设置合理的置信度阈值，确保关键订单有人工把关</li><li><strong>效率</strong>：使用异步处理、批处理等技术提升吞吐量</li><li><strong>可维护性</strong>：建立反馈机制，持续优化系统性能</li><li><strong>可观测性</strong>：完善的监控和告警系统，及时发现问题</li></ol><p>通过LLM驱动的智能分类器，配合专业的Agent路由系统，可以显著提升订单处理的自动化水平和准确性。随着业务的发展，系统可以不断学习和优化，适应新的订单类型和业务场景。</p><h2 id=延伸阅读>延伸阅读</h2><ul><li><a href=/post/2025/107-intent-recognition-best-practices/>意图识别最佳实践</a></li><li><a href=/post/2025/105-rag-retrieval-augmented-generation-guide/>RAG检索增强生成指南</a></li><li><a href=/post/2025/110-ai-exam-grading-agent-best-practices/>AI考试批改Agent最佳实践</a></li></ul><hr><p><em>本文代码示例使用Anthropic Claude API，实际应用中可根据需求选择其他LLM提供商。所有代码均为示例，生产环境使用前需要根据实际业务场景进行调整和测试。</em></p><div class=blog-tags><a href=https://hugozhu.site/tags/ai/>AI</a>&nbsp;
<a href=https://hugozhu.site/tags/llm/>LLM</a>&nbsp;
<a href=https://hugozhu.site/tags/document-classification/>document-classification</a>&nbsp;
<a href=https://hugozhu.site/tags/agent-routing/>agent-routing</a>&nbsp;
<a href=https://hugozhu.site/tags/nlp/>NLP</a>&nbsp;
<a href=https://hugozhu.site/tags/prompt-engineering/>prompt-engineering</a>&nbsp;
<a href=https://hugozhu.site/tags/workflow-automation/>workflow-automation</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fhugozhu.site%2fpost%2f2025%2f111-order-document-classifier-agent-routing%2f&amp;text=%e6%9e%84%e5%bb%ba%e9%ab%98%e8%b4%a8%e9%87%8f%e8%ae%a2%e5%8d%95%e6%96%87%e6%a1%a3%e5%88%86%e7%b1%bb%e5%99%a8%ef%bc%9a%e6%99%ba%e8%83%bd%e5%af%bc%e6%b5%81%e5%88%b0%e4%b8%93%e4%b8%9aAgent&amp;via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fhugozhu.site%2fpost%2f2025%2f111-order-document-classifier-agent-routing%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fhugozhu.site%2fpost%2f2025%2f111-order-document-classifier-agent-routing%2f&amp;title=%e6%9e%84%e5%bb%ba%e9%ab%98%e8%b4%a8%e9%87%8f%e8%ae%a2%e5%8d%95%e6%96%87%e6%a1%a3%e5%88%86%e7%b1%bb%e5%99%a8%ef%bc%9a%e6%99%ba%e8%83%bd%e5%af%bc%e6%b5%81%e5%88%b0%e4%b8%93%e4%b8%9aAgent" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fhugozhu.site%2fpost%2f2025%2f111-order-document-classifier-agent-routing%2f&amp;title=%e6%9e%84%e5%bb%ba%e9%ab%98%e8%b4%a8%e9%87%8f%e8%ae%a2%e5%8d%95%e6%96%87%e6%a1%a3%e5%88%86%e7%b1%bb%e5%99%a8%ef%bc%9a%e6%99%ba%e8%83%bd%e5%af%bc%e6%b5%81%e5%88%b0%e4%b8%93%e4%b8%9aAgent" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fhugozhu.site%2fpost%2f2025%2f111-order-document-classifier-agent-routing%2f&amp;title=%e6%9e%84%e5%bb%ba%e9%ab%98%e8%b4%a8%e9%87%8f%e8%ae%a2%e5%8d%95%e6%96%87%e6%a1%a3%e5%88%86%e7%b1%bb%e5%99%a8%ef%bc%9a%e6%99%ba%e8%83%bd%e5%af%bc%e6%b5%81%e5%88%b0%e4%b8%93%e4%b8%9aAgent" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fhugozhu.site%2fpost%2f2025%2f111-order-document-classifier-agent-routing%2f&amp;description=%e6%9e%84%e5%bb%ba%e9%ab%98%e8%b4%a8%e9%87%8f%e8%ae%a2%e5%8d%95%e6%96%87%e6%a1%a3%e5%88%86%e7%b1%bb%e5%99%a8%ef%bc%9a%e6%99%ba%e8%83%bd%e5%af%bc%e6%b5%81%e5%88%b0%e4%b8%93%e4%b8%9aAgent" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section><h4 class=see-also>See also</h4><ul><li><a href=/post/2026/91-agent-reinforcement-learning-best-practices/>Agent强化学习的最佳实践：并行任务处理与性能优化</a></li><li><a href=/post/2025/113-claude-code-auto-correction-agent-loop/>Claude Code自动修正生成代码的原理解析：Agent Loop最佳实践</a></li><li><a href=/post/2025/112-ai-powered-google-resume-from-personal-website/>如何用 AI 将个人网站转化为专业的 Google 求职简历</a></li><li><a href=/post/2025/101-multimodal-ai-b2b-order-normalization/>多模态AI驱动的B2B订单归一化：从非标准文档到MES系统的智能工作流</a></li><li><a href=/post/2025/110-ai-exam-grading-agent-best-practices/>小学标准化试卷AI批改Agent最佳工程实践</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://hugozhu.site/post/2025/109-api-mcp-skills-explained/ data-toggle=tooltip data-placement=top title=API、MCP和Skills：三个概念的本质区别>&larr; Previous Post</a></li><li class=next><a href=https://hugozhu.site/post/2025/110-ai-exam-grading-agent-best-practices/ data-toggle=tooltip data-placement=top title=小学标准化试卷AI批改Agent最佳工程实践>Next Post &rarr;</a></li></ul><div class=disqus-comments><button id=show-comments class="btn btn-default" type=button>Show <span class=disqus-comment-count data-disqus-url=https://hugozhu.site/post/2025/111-order-document-classifier-agent-routing>comments</span></button><div id=disqus_thread></div><script type=text/javascript>var disqus_config=function(){this.page.url="https://hugozhu.site/post/2025/111-order-document-classifier-agent-routing"}</script></div></div></div></div><footer><div class=container><div class=row><div class=disclaimer><b>Disclaimer:</b> The opinions expressed herein are my own personal opinions and do not represent my company’s view in any way.</div></div><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2026
&nbsp;&bull;&nbsp;
<a href=https://hugozhu.site/>All about Raspberry Pi</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.145.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=https://hugozhu.site/js/main.js></script><script src=https://hugozhu.site/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://hugozhu.site/js/load-photoswipe.js></script><script>(function(){var t,n="617d351a633194d48",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+n,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>$(function(){$("#show-comments").on("click",function(){var e="hugozhu";(function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)})(),$(this).hide()})})</script><script id=dsq-count-scr src=//hugozhu.disqus.com/count.js async></script></body></html>
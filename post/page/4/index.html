<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Posts - Hugo Zhu's Blog</title>
<meta name=author content="Hugo Zhu"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"All about Raspberry Pi","url":"\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"\/"}</script><meta property="og:title" content="Posts"><meta property="og:image" content="/img/pi.png"><meta property="og:url" content="/post/"><meta property="og:type" content="website"><meta property="og:site_name" content="All about Raspberry Pi"><meta name=twitter:title content="Posts"><meta name=twitter:image content="/img/pi.png"><meta name=twitter:card content="summary_large_image"><link href=/img/pi.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.128.2"><link rel=alternate href=/index.xml type=application/rss+xml title="All about Raspberry Pi"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=/css/highlight.min.css><link rel=stylesheet href=/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-W88HDMN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-W88HDMN")}</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/>All about Raspberry Pi</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>Tools</a><div class=navlinks-children><a href=https://nddapp.com/json-encoder.html>HTML Tools</a>
<a href=https://www.birme.net/>Imaeg Resizing</a>
<a href=https://jwt.io/>JWT Token Tool</a></div></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li><li><a href=#modalSearch data-toggle=modal data-target=#modalSearch style=outline:none><span class="hidden-sm hidden-md hidden-lg">Search</span> <span id=searchGlyph class="glyphicon glyphicon-search"></span></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="All about Raspberry Pi" href=/><img class=avatar-img src=/img/pi.png alt="All about Raspberry Pi"></a></div></div></div></nav><div id=modalSearch class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal>&#215;</button><h4 class=modal-title>Search All about Raspberry Pi</h4></div><div class=modal-body><gcse:search></gcse:search></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>Close</button></div></div></div></div><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Posts</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 7, 2024
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;0&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;0&nbsp;words</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=posts-list><article class=post-preview><a href=/post/2014/50-use-gradle-to-customize-apk-build/><h2 class=post-title>使用Gradle生成一个App的不同版本，且可以同时安装在一个手机上</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on August 3, 2014
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;138&nbsp;words</span></p><div class=post-entry>背景 开发一个App一般会生成内测版和正式版，甚至还会有不同渠道的版本，不同版本的配置可能会不一样，比如内测版会需要记录完整的日志。
Android手机对于同样的Application Id的App只能安装一个版本，如果我们需要同时安装内测版和正式版，就必须修改其中一个版本的Application Id。
解决方案 Gradle支持buildTypes和productFlavors两种定制方法，这里只介绍通过buildType的解决方案。通过productFlavors则可有效解决渠道包，arm，x86等分平台以及付费版和广告版的打包问题。
修改debug版的包名 配置如下：
android { buildTypes { release { ... } debug { applicationIdSuffix '.debug' ... } } } 修正资源文件里的包名 如果你的项目里使用了自定义的View，且有自定义的属性时，会需要修正一下xml命名空间里的包名。
android.applicationVariants.all { variant -> def buildType = variant.buildType def encoding = java.nio.charset.Charset.defaultCharset().toString() if (buildType.applicationIdSuffix) { def defaultPackageId = variant.packageName.replaceAll(buildType.applicationIdSuffix,'') variant.mergeResources.doLast { def dir = file("${buildDir}/intermediates/res/${variant.dirName}/layout") dir.listFiles().each { f-> String content = f.getText(encoding) content = content.replaceAll("res/"+defaultPackageId, "res/"+variant.packageName) f.write(content, encoding) } } } } 定制APK的应用名称 如果同时安装两个版本，那么最好能从应用名称上来区别一下，一般我们在AndroidManifest.
<a href=/post/2014/50-use-gradle-to-customize-apk-build/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=/tags/android/>Android</a>&nbsp;</div></article><article class=post-preview><a href=/post/2014/48-install-3rd-party-app-on-tv-box/><h2 class=post-title>安装第三方App到电视盒子</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 26, 2014
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;19&nbsp;words</span></p><div class=post-entry><h1 id=安装第三方app方法1>安装第三方App方法1</h1><ol><li>准备一个U盘，注意用FAT格式（Windows能读写就OK）</li><li>将需要安装的App下载到U盘，文件后缀名必须是.apk</li><li>将U盘插入电视盒子，然后通过盒子自身带的文件管理App安装：如Magic Box：应用－－> 本地播放，进入后选中U盘上的.apk文件即可安装</li></ol><h1 id=安装第三方app方法2>安装第三方App方法2</h1><ol><li>如果盒子不带USB盘，还可以用adb远程安装</li><li>adb connect &lt;your_magic_box_ip></li><li>adb install &lt;you_app_to_install>.apk</li></ol><h1 id=直播和回放app>直播和回放App</h1><ol><li>在电脑上用浏览器下载：http://app.shafa.com/shafa.apk 到U盘</li><li>按方法1安装好后，在“应用“中找到“沙发管家”</li><li>启动“沙发管家”，安装直播App：如“龙龙直播”，也有支持回放的App，如“电视猫视频”等。</li></ol></div><div class=blog-tags><a href=/tags/android/>Android</a>&nbsp;</div></article><article class=post-preview><a href=/post/2014/47-use-gradle-properties-to-set-alternative-android-build-tools/><h2 class=post-title>Gradle的Properties</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 23, 2014
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;173&nbsp;words</span></p><div class=post-entry>问题背景 团队一起在开发一个Android项目，工程师有的使用Eclipse，有个使用Intellij IDEA，有的使用Android Studio。每个人安装的Android SDK build-tools可能都不一样，有的是19.0.3，有的是19.1.0，不同版本的build-tools对Gradle Plugin也有相应的要求，如19.0.3对应的是com.android.tools.build:gradle:0.10.+，19.1.0对应的是com.android.tools.build:gradle:0.12.+，下面是一个典型的build.gradle配置文件。
buildscript { repositories { mavenCentral() } dependencies { classpath 'com.android.tools.build:gradle:0.10.+' } } apply plugin: 'android-library' android { compileSdkVersion 19 buildToolsVersion 19.0.3 defaultConfig { minSdkVersion 8 targetSdkVersion 19 } } 在合作开发中遇到的一个尴尬的问题是，IDEA最新版还不能很好的支持Gradle Plugin 0.12+，而Android Studio最新版则要求使用0.12+。大家又共用一个Git仓库。可能的解决方案是，从Git checkout出来的项目需要有一个基础的版本号，但是开发者可以在本地通过一处文件（不check in到git）来重载版本号。
解决方案 Gradle支持三种Properties, 这三种Properties的作用域和初始化阶段都不一样，下面分别列出了其部分特点。:
System Properties：
可通过gradle.properties文件，环境变量或命令行-D参数设置 2. 可在setting.gradle或build.gradle中动态修改，在setting.gradle中的修改对buildscript block可见； 所有工程可见，不建议在build.gradle中修改 多子工程项目中，子工程的gradle.properties会被忽略掉，只有root工程的gradle.properties有效； Project Properties：
可通过gradle.properties文件，环境变量或命令行-P参数设置，优先级是: 可在build.gradle中动态修改，但引用不存在的project properties会立即抛错 动态修改过的project properties在buildscript block中不可见 Project ext properties：
可在项目的build.gradle中声明和使用，本工程和子工程可见 不能在setting.gradle中访问 如果有多处设置，加载次序如下（注意：gradle 2.0是这样的, 1.10~1.12有bug）, 后面的覆盖前面的设置
<a href=/post/2014/47-use-gradle-properties-to-set-alternative-android-build-tools/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=/tags/android/>Android</a>&nbsp;
<a href=/tags/gradle/>Gradle</a>&nbsp;</div></article><article class=post-preview><a href=/post/2014/46-async-android/><h2 class=post-title>Android异步编程</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on June 29, 2014
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;113&nbsp;words</span></p><div class=post-entry>Android的线程和内存模型 Android操作系统在boot后，会启动一个Zygote(受精卵)进程，Zygote进程负责创建大部分应用程序进程。Zygote进程启动加载核心程序库和数据结构到内存后会创建一个Dalvik虚拟机（DVM）进程－-SystemServer，此进程会包含大部分的系统服务（包括管理Activity的服务ActivityManagerService），SystemServer初始化后，Zygote进程会侦听本地的socket端口, 等待进一步的指令。当新的app被启动时，Zygote会为这个app创建一个DVM&mdash;-直接fork出一个子进程，这种架构的好处是同时启动多个App时，多个App进程可以访问共享内存。
Android App的进程也是一个DVM，内部有许多线程在执行，比如，主UI线程（Main Thread），垃圾回收线程等。其中主UI线程负责执行我们写的应用代码。对于只做很少的I/O操作或耗时操作的App，单一线程开发模式问题不大，但是如果有大量IO或者CPU计算的任务，我们就必须在其他线程内完成了。
因为主UI线程需要根据硬件刷新率[^3]同步用户界面的重绘。手机应用体验流畅要求界面帧率[^3]达到每秒60，也就是说每16.67毫秒就需要重绘一帧，这意味着如果我们在主线程上执行的任务超过16毫秒，就会出现丢帧现象，也就是界面会开始变卡。。。
Android异步执行任务的方法有以下几种：
AsyncTask AsyncTask是最常用的异步方法，功能结构设计的也很丰富，给使用者足够的控制，使用上主要是将异步执行的任务放在下面方法里。
protected Result doInBackground(Params... params) 然后调用.execute(params)方法即可。
AsyncTask的执行逻辑在API Level 3只能串行执行， 在API Level 4改成了最多128个线程的线程池执行，API Level 11则改成了缺省所有的AsyncTask是在一个线程中顺序执行的，这样可以保证执行和提交的次序一致，如果希望能并发的执行，可以用下面的方法在线程池内执行：
task.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, params); AsyncTask.THREAD_POOL_EXECUTOR是ThreadPoolExecutor的一个实例，配置是最少5个线程，最多128个。如果需要自己来配置线程池大小，你可以传递自己配置的一个实例到上述方法。
使用AsyncTask需要注意的几个问题：
碎片化问题 因为不同版本的Android AsyncTask缺省执行逻辑并不一样，可能在不同机型上表现不一致。如果要自己控制AsyncTask的并发度，解决这个问题的建议是复制Android SDK的AsyncTask源码自己实现一个AsyncTask。
Activity生命周期问题 Activity可能早于AsyncTask执行完被销毁，如果AsyncTask还继续执行，有可能会浪费资源，并且如果AsyncTask里引用了Activity或部分的View Hierarchy，还会造成引用的对象不会被垃圾回收而引起内存泄漏。通常AsyncTask会定义为Activity的一个匿名inner class，这会建立一个隐式的引用到Activity。
解决的方法是：
在Activity里的onPause方法里及时取消不需要再执行的AsyncTask（这种方法在切换到横屏时会重启异步任务，有点浪费） 更好的是使用retained headless fragment来解决生命周期问题，具体演示代码见参考链接 Async比较合适的是较短的（1，2秒），CPU密集计算或读写文件等阻塞IO操作。耗时较长的网络调用用Async不是最合适的。
Handler & HandlerThread Handler的异步编程是基于消息队列模型的。执行任务的线程称之为Looper线程，其他线程则将需要异步执行的任务发送给Looper线程&ndash;插入其消息队列，方法有：post（较方便使用，但每次需要创建新对象）或sendMessage（较高效，复用消息实例，适合执行大量类似的异步任务）
Looper Looper和它的名字意思一样就是Looper线程会永远循环，当没有消息的时候，Looper线程（消费者）会使用(Object.wait)方法等待其他线程（生产者）插入新的任务消息，这时候其他线程(Object.notify)
Android的主线程其实就是一个Looper线程。
需要注意的是，使用Handler和AsyncTask一样，要注意匿名inner class对Activity的隐式引用而造成内存泄漏，所以使用的时候要记得清理；
解决方法是使用对使用的Activity中的View对象用Weak Reference，并处理当View对象为null的情况。
Handler适合更长一点的（>2秒）的异步任务处理。
Loader Loader在Android编程框架中被广泛用于后台加载数据（从文件，数据库甚至网络）。
AsyncTaskLoader 具体的Loader实现。
CursorLoader 用户数据库数据后台加载。
Loader在使用上比较大的优势是和Activity的部分解耦，更见到的生命周期管理。
IntentService IntentService是Service的一个实现类。其内部实现包含了一个HandlerThread，当任务提交给IntentService时，会被加到队列并顺序处理。
public class MyIntentService extends IntentService { public MyIntentService() { super("thread-name"); } protected void onHandleIntent(Intent intent) { // executes on the background HandlerThread.
<a href=/post/2014/46-async-android/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=/tags/android/>Android</a>&nbsp;</div></article><article class=post-preview><a href=/post/2014/45-android-development-productivity-tips/><h2 class=post-title>提高Android开发效率的小贴士</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on February 10, 2014
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;47&nbsp;words</span></p><div class=post-entry><h1 id=查看日志-adb-logcat>查看日志 adb logcat</h1><p>下面命令将只显示错误日志，和所有Tag＝mytag的调试日志，-C 会用不同颜色区分不同级别的日志，但只有Android 4.3以后才支持。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb logcat [-C] *:E &lt;mytag&gt;:D
</span></span></code></pre></div><h1 id=远程调试-adb-over-tcp>远程调试 adb over TCP</h1><p>首先在手机或Pad上执行以下命令（要求root）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>su
</span></span><span class=line><span class=cl>setprop service.adb.tcp.port 5555
</span></span><span class=line><span class=cl>stop adbd
</span></span><span class=line><span class=cl>start adbd
</span></span></code></pre></div><p>再执行下面命令则可以看到手机的网络地址</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>netcfg | grep wlan
</span></span></code></pre></div><p>在电脑上则执行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb connect &lt;mobile_phone_ip&gt; 5555
</span></span><span class=line><span class=cl>adb shell
</span></span></code></pre></div><p>安装运行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>gradle installDebug &amp;&amp; adb shell am start -n com.laiwang.protocol.android/.MainActivity
</span></span></code></pre></div><h1 id=over>Over</h1></div><div class=blog-tags><a href=/tags/android/>Android</a>&nbsp;</div></article><article class=post-preview><a href=/post/2013/44-copy-android-app-data/><h2 class=post-title>拷贝Android应用的数据</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on November 27, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;48&nbsp;words</span></p><div class=post-entry><h1 id=有root权限>有root权限</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb shell su -c cat /data/data/app.package.name/databases/application.sqlite | sed &#39;s/\r$//&#39; &gt; application.sqlite
</span></span></code></pre></div><h1 id=应用可调试的话>应用可调试的话</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb shell
</span></span><span class=line><span class=cl>run-as app.package.name \
</span></span><span class=line><span class=cl>cp /data/data/package.name/databases/application.sqlite /sdcard/
</span></span><span class=line><span class=cl>exit
</span></span><span class=line><span class=cl>adb pull /sdcard/application.sqlite ~/
</span></span></code></pre></div><h1 id=使用备份方法>使用备份方法</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb backup -f ~/data.ab -noapk app.package.name
</span></span><span class=line><span class=cl>dd if=data.ab bs=1 skip=24 | python -c &#34;import zlib,sys;sys.stdout.write(zlib.decompress(sys.stdin.read()))&#34; | tar -xvf -
</span></span></code></pre></div><h1 id=参考链接>参考链接</h1><ol><li><a href=http://blog.shvetsov.com/2013/02/access-android-app-data-without-root.html>http://blog.shvetsov.com/2013/02/access-android-app-data-without-root.html</a></li></ol></div><div class=blog-tags><a href=/tags/android/>Android</a>&nbsp;</div></article><article class=post-preview><a href=/post/2013/42-sharp-gp2y1010au0f-optical-dust-sensor/><h2 class=post-title>使用夏普GP2Y1010AU0F灰尘传感器检测空气质量</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 21, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;273&nbsp;words</span></p><div class=post-entry>夏普GP2Y1010AU0F灰尘传感器价格较便宜，能检测出室内空气中的灰尘和烟尘含量。另外还有韩国SYHITECH生产的DSM501A粉尘传感器也有类似功能。
检测原理 其原理如下图，传感器中心有个洞可以让空气自由流过，定向发射LED光，通过检测经过空气中灰尘折射过后的光线来判断灰尘的含量。
电路图 因为数据是通过pin 5的电压模拟信号输出的，而树莓派的引脚不支持模拟信号直接读取（需要增加数模转换芯片），所以先用Arduino来实验。
Arduino 代码 根据电路图， 把Arduino和传感器连接起来：
Sharp pin 1 (V-LED) => 5V 串联1个150欧姆的电阻（最好在电阻一侧和GND之间再串联一个220uf的电容） Sharp pin 2 (LED-GND) => GND Sharp pin 3 (LED) => Arduino PIN 2 （开关LED） Sharp pin 4 (S-GND) => GND Sharp pin 5 (Vo) => Arduino A0 pin （空气质量数据通过电压模拟信号输出） Sharp pin 6 (Vcc) => 5V /* Interface to Sharp GP2Y1010AU0F Particle Sensor Program by Christopher Nafis Written April 2012 http://www.sparkfun.com/datasheets/Sensors/gp2y1010au_e.pdf http://sensorapp.net/?p=479 Sharp pin 1 (V-LED) => 5V (connected to 150ohm resister) Sharp pin 2 (LED-GND) => Arduino GND pin Sharp pin 3 (LED) => Arduino pin 2 Sharp pin 4 (S-GND) => Arduino GND pin Sharp pin 5 (Vo) => Arduino A0 pin Sharp pin 6 (Vcc) => 5V */ #include &lt;SPI.
<a href=/post/2013/42-sharp-gp2y1010au0f-optical-dust-sensor/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=/tags/arduino/>Arduino</a>&nbsp;</div></article><article class=post-preview><a href=/post/2013/41-use-phantomjs-on-raspberry-pi-to-login-weibo/><h2 class=post-title>在树莓派上使用Phantomjs自动登录微博</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 21, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;196&nbsp;words</span></p><div class=post-entry>使用过新浪开放平台的朋友都知道用户对小应用（用户数较少的）的授权Token很容易过期，自动续期要求授权过的用户在过期前重新打开授权页。如果你想实现一个自动备份自己微博的App，就不得每天（周）自己去访问授权页（想死的心都有了吧？）。这里介绍一种通过脚本自动登录微博获取最新oAuth token的方法（需要微博登录名和密码），合适自己玩。将脚本部署在树莓派上后，我再也不用每周都去登录一次授权页了，只是收到报警消息后（经常是帐号被冻结了）需要手动处理一下。
Phantomjs Phantomjs 是一个开源的，没有界面可运行在命令行，跨平台，基于WebKit的全功能浏览器，可以用来做网站自动化测试。从源代码编译比较费时间，可以直接下载二进制版本，树莓派的版本在这里可下载。Phantomjs下载好了后就一个可执行文件，依赖非常少，我很喜欢这种方式。
代码 以下代码使用提供的微博用户名和密码登录，获得Token后还会打开微博首页看帐号是否被冻结了。
var page = require('webpage').create(), system = require('system'), fs = require('fs'), address; var weibo_userid = system.args[1] var weibo_passwd = system.args[2] var startUrl = "https://api.weibo.com/oauth2/authorize?client_id=&lt;your_app_key>&amp;redirect_uri=&lt;your_return_url>/&amp;response_type=token"; var verify_weibo_freeze = false; page.onResourceReceived = function (res,network) { if (res.stage == "end") { // console.log("\t&lt;-" + res.url); if (res.url.indexOf("authorize?client_id")>0) { startUrl = res.url } if (res.url.indexOf("?access_token")>0) { var pos1 = res.url.indexOf("access_token=") var pos2 = res.url.indexOf("&") var access_token = res.url.substring(pos1+"access_token=".length, pos2) console.
<a href=/post/2013/41-use-phantomjs-on-raspberry-pi-to-login-weibo/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=/tags/javascript/>Javascript</a>&nbsp;</div></article><article class=post-preview><a href=/post/2013/40-try-out-sublime-3-beta-on-mac/><h2 class=post-title>在Mac上使用Sublime 3写Go代码</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 11, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;91&nbsp;words</span></p><div class=post-entry>Sublime 是一个相当好用的文本编辑器，界面简洁，功能强大。最近Sublime 3 Beta 出来了, 体验了一下，发现启动速度比之前快了很多。
下载安装 下载地址： http://www.sublimetext.com/3
安装Package Control Sublime 支持插件来丰富其功能，package control 本身也是一个插件，可以用来管理其他插件，所以我们要先安装Package Control，Sublime 3需要安装Pacakge Control Alpha.
cd "Library/Application Support/Sublime Text 3" cd Packages/ git clone https://github.com/wbond/sublime_package_control.git "Package Control" cd "Package Control" git checkout python3 安装GoSublime 重启Sublime后
按cmd+shift+p (OS X)或press ctrl+shift+p (Windows, Linux) 在弹出的输入框中输入 PacInstall 选择 Package Control: Install Package 在稍后弹出的输入框内输入"Gosublime"，选择安装 好了，就这样可以开始写Go代码了。
Tips 我的Sublime配置
{ "font_face": "Microsoft YaHei", "font_options": [ ], "font_size": 18.0, "line_padding_top": 0 } 按快捷键Shift + Command + L可以按列编辑
<a href=/post/2013/40-try-out-sublime-3-beta-on-mac/ class=post-read-more>[Read More]</a></div><div class=blog-tags><a href=/tags/sublime/>Sublime</a>&nbsp;</div></article><article class=post-preview><a href=/post/2013/39-replace-usb-disk-on-raspberry-pi/><h2 class=post-title>替换树莓派的U盘</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 11, 2013
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;66&nbsp;words</span></p><div class=post-entry><p>除了SD卡上的存储，树莓派还可以使用U盘来做存储，有时候我们可能需要替换已有的U盘为更大容量的。在Mac上可以采用下面的方法：</p><ol><li><p>备份已有的U盘，把U盘从树莓派上拔下来插在Mac上，找出U盘对应的盘符（下例为<code>/dev/disk2</code>）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>20:51:19 hugozhu-mac-mini ~ $ diskutil list
</span></span><span class=line><span class=cl>/dev/disk0
</span></span><span class=line><span class=cl>   #:                       TYPE NAME                    SIZE       IDENTIFIER
</span></span><span class=line><span class=cl>   0:      GUID_partition_scheme                        *500.1 GB   disk0
</span></span><span class=line><span class=cl>   1:                        EFI                         209.7 MB   disk0s1
</span></span><span class=line><span class=cl>   2:                  Apple_HFS Macintosh HD            499.2 GB   disk0s2
</span></span><span class=line><span class=cl>   3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3
</span></span><span class=line><span class=cl>/dev/disk2
</span></span><span class=line><span class=cl>   #:                       TYPE NAME                    SIZE       IDENTIFIER
</span></span><span class=line><span class=cl>   0:     FDisk_partition_scheme                        *2.1 GB     disk2
</span></span></code></pre></div><p>使用 dd 命令把U盘拷贝到<code>raspberrypi.img</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo dd if=/dev/disk2 of=raspberrypi.img conv=notrunc
</span></span></code></pre></div></li><li><p>从Mac上取下旧U盘，把新的U盘插入同一个USB口，注意新U盘容量要大于旧的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo dd of=/dev/disk2 if=raspberrypi.img conv=notrunc
</span></span></code></pre></div></li><li><p>把新U盘插入树莓派，并mount上，用以下命令把U盘的多余空间用起来</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>resize2fs /dev/sda
</span></span></code></pre></div></li></ol></div><div class=blog-tags><a href=/tags/linux/>Linux</a>&nbsp;</div></article></div><ul class="pager main-pager"><li class=previous><a href=/post/page/3/>&larr; Newer Posts</a></li><li class=next><a href=/post/page/5/>Older Posts &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class=disclaimer><b>Disclaimer:</b> The opinions expressed herein are my own personal opinions and do not represent my company’s view in any way.</div></div><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:hugozhu@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.facebook.com/hugozhu title=Facebook><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/hugozhu title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/hugozhu title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://weibo.com/hugozhu title=Weibo><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-weibo fa-stack-1x fa-inverse"></i></span></a></li><li><a href=/post/index.xml title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=blog.hugozhu.site>Hugo Zhu</a>
&nbsp;&bull;&nbsp;&copy;
2024
&nbsp;&bull;&nbsp;
<a href=/>All about Raspberry Pi</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.128.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=/js/main.js></script><script src=/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=/js/load-photoswipe.js></script><script>(function(){var t,n="617d351a633194d48",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+n,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>$(function(){$("#show-comments").on("click",function(){var e="hugozhu";(function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)})(),$(this).hide()})})</script><script id=dsq-count-scr src=//hugozhu.disqus.com/count.js async></script></body></html>